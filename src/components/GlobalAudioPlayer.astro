<!--
  GlobalAudioPlayer.astro
  
  Global audio player component for seamless music playback across pages.
  Features play/pause controls, progress tracking, volume control, and track information.
  Persists during page transitions and manages global audio state throughout the site.
-->

<div id="global-audio-player" class="global-audio-player hidden" style="view-transition-name: global-audio-player;">
  <div class="player-content">
    <div class="track-info">
      <span class="track-title" id="current-track-title">No track selected</span>
      <span class="track-artist" id="current-track-artist"></span>
    </div>
    
    <div class="player-controls">
      <button class="control-btn" id="play-pause-btn">
        <svg class="play-icon" width="24" height="24" viewBox="0 0 24 24">
          <path d="M8 5v14l11-7z"/>
        </svg>
        <svg class="pause-icon" width="24" height="24" viewBox="0 0 24 24" style="display: none;">
          <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
        </svg>
      </button>
    </div>
    
    <div class="progress-section">
      <div class="time-display">
        <span id="current-time">0:00</span>
      </div>
      <div class="progress-container">
        <input 
          type="range" 
          id="progress-slider" 
          min="0" 
          max="100" 
          value="0" 
          class="progress-slider"
        />
      </div>
      <div class="time-display">
        <span id="duration">0:00</span>
      </div>
    </div>
    
    <div class="volume-section">
      <button class="control-btn" id="volume-btn">
        <svg class="volume-icon" width="20" height="20" viewBox="0 0 24 24">
          <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
        </svg>
      </button>
      <input 
        type="range" 
        id="volume-slider" 
        min="0" 
        max="100" 
        value="70" 
        class="volume-slider"
      />
    </div>
    
    <button class="control-btn close-btn" id="close-player-btn">
      <svg width="20" height="20" viewBox="0 0 24 24">
        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
      </svg>
    </button>
  </div>
  
  <audio 
    id="global-audio" 
    preload="none"
    playsinline
    controlslist="nodownload"
  ></audio>
</div>

<style lang="scss">
  @use '../styles/helpers/responsive' as *;
  @use '../styles/helpers/colors' as *;
  @use '../styles/helpers/fonts' as *;

  .global-audio-player {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    @include bg-color('bg-primary');
    border-bottom: 1px solid var(--color-border);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    view-transition-name: global-audio-player;
    
    .player-content {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      padding: 1rem 2rem;
      max-width: 1200px;
      margin: 0 auto;
      
      @include media-up('xl') {
        max-width: 1400px;
        gap: 2rem;
      }
      
      @include media-up('xxl') {
        max-width: 1600px;
        gap: 2.5rem;
      }
      
      @include media-down('md') {
        gap: 1rem;
        padding: 0.25rem 1rem 0.5rem 1rem;
        flex-wrap: wrap;
        position: relative;
        min-height: 80px;
      }
    }
    
    .track-info {
      flex: 1;
      min-width: 200px;
      
      .track-title {
        display: block;
        @include font-size('base');
        @include font-weight('semibold');
        @include text-color('text-primary');
        margin-bottom: 0.25rem;
      }
      
      .track-artist {
        display: block;
        @include font-size('sm');
        @include text-color('text-secondary');
      }
      
      @include media-down('md') {
        order: 2;
        width: calc(100% - 120px);
        text-align: center;
        margin: 0 auto;
        position: absolute;
        left: 60px;
        right: 60px;
        top: 50%;
        transform: translateY(-50%);
      }
    }
    
    .player-controls {
      @include media-down('md') {
        order: 1;
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
      }
    }
    
    .progress-section {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex: 2;
      min-width: 300px;
      
      @include media-up('lg') {
        flex: 3;
        min-width: 400px;
        gap: 1.25rem;
      }
      
      @include media-up('xl') {
        flex: 4;
        min-width: 500px;
        gap: 1.5rem;
      }
      
      @include media-down('md') {
        order: 4;
        width: 100%;
        margin: 4rem 0 0 0;
        position: static;
        transform: none;
      }
      
      .time-display {
        @include font-size('sm');
        @include text-color('text-secondary');
        @include font-weight('medium');
        min-width: 40px;
      }
      
      .progress-container {
        flex: 1;
      }
    }
    
    .volume-section {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      
      @include media-down('md') {
        display: none;
      }
      
      .volume-slider {
        width: 80px;
        
        @include media-down('md') {
          width: 60px;
        }
      }
    }
    
    .control-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 50%;
      @include text-color('text-primary');
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      
      &:hover {
        @include bg-color('bg-secondary');
      }
      
      &:active {
        transform: scale(0.95);
      }
      
      &.needs-resume {
        animation: pulse-resume 1.5s infinite;
        background: var(--color-primary);
        color: white;
        
        &:hover {
          background: var(--color-primary-hover, var(--color-primary));
        }
      }
      
      svg {
        fill: currentColor;
      }
    }
    
    .close-btn {
      @include media-down('md') {
        order: 3;
        position: absolute;
        right: 1rem;
        top: 50%;
        transform: translateY(-50%);
      }
    }
    
    .progress-slider,
    .volume-slider {
      -webkit-appearance: none;
      height: 6px;
      border-radius: 3px;
      @include bg-color('border-light');
      outline: none;
      cursor: pointer;
      
      &::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: var(--color-primary);
        cursor: pointer;
        transition: all 0.2s ease;
        
        &:hover {
          transform: scale(1.2);
        }
      }
      
      &::-moz-range-thumb {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: var(--color-primary);
        cursor: pointer;
        border: none;
        transition: all 0.2s ease;
        
        &:hover {
          transform: scale(1.2);
        }
      }
    }
    
    .progress-slider {
      width: 100%;
    }
  }

  .hidden {
    display: none;
  }

  @keyframes pulse-resume {
    0%, 100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.8;
      transform: scale(1.05);
    }
  }
</style>
<script>
  import '../utils/GlobalAudioPlayer.js';
</script>
