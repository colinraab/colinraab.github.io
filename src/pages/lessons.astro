<!--
  lessons.astro
  
  Music lessons service page offering 1-on-1 instruction.
  Details teaching services, pricing, and contact information.
  Covers music production, audio engineering, and music theory instruction.
-->

---
import PageLayout from '../layouts/PageLayout.astro';
---

<PageLayout title="Music Lessons - Colin Raab" description="Personalized 1-on-1 music lessons covering production, audio engineering, and music theory.">
  <section class="section lessons-page">
    <div class="container">
      <div class="page-hero">
        <h1>1-on-1 Music Lessons</h1>
        <p class="lead">
          Personalized instruction for all skill levels
        </p>
      </div>
      
      <div class="lessons-description">
        <p class="lessons-intro">
          With over 10 years of experience in music production, 
          I offer personalized music lessons tailored to your specific goals and learning style. 
          Whether you're a complete beginner or looking to refine advanced techniques, 
          I provide comprehensive instruction.
        </p>
        
        <div class="lessons-offerings">
          <h3>What I Offer</h3>
          <ul class="offerings-list">
            <li>Music production in Ableton Live, Logic Pro, and other DAWs</li>
            <li>DJ techniques and performance</li>
            <li>Audio engineering fundamentals</li>
            <li>Music theory and composition</li>
            <li>Recording techniques and home studio setup</li>
            <li>Mixing and mastering instruction</li>
          </ul>
        </div>
        
        <div class="reviews-section">
          <div class="reviews-container" id="reviewsContainer">
            <div class="reviews-track" id="reviewsTrack">
              <div class="review-card">
                <div class="review-stars">★★★★★</div>
                <p class="review-text">
                  "Colin was great - I have a fairly extensive and technical background with other audio DAWs so I know enough to know when someone knows audio software well. He was easy to talk to and gave information well. Recommended!"
                </p>
                <div class="review-author">- Tom R.</div>
              </div>
              
              <div class="review-card">
                <div class="review-stars">★★★★★</div>
                <p class="review-text">
                  "Colin is an amazing teacher. Truly appreciate his way of explaining everything succinctly, clearly, and in a way I can understand having absolutely no music background or knowledge."
                </p>
                <div class="review-author">- May E.</div>
              </div>
              
              <div class="review-card">
                <div class="review-stars">★★★★★</div>
                <p class="review-text">
                  "Colin is a great music production tutor! He is very knowledgeable, easy to work with, and a pleasure to learn from. He covered mixing techniques in an understandable way and also gave great feedback on my projects. I am excited to continue my lessons with Colin!"
                </p>
                <div class="review-author">- Erika M.</div>
              </div>
              
              <div class="review-card">
                <div class="review-stars">★★★★★</div>
                <p class="review-text">
                  "Very great and very helpful, always very thorough with everything that he explains. Colin will help you out in anything that you would want to learn/need help in, Colin is incredibly specialized in his field and strongly recommend to anyone, he is an amazing teacher. 10/10"
                </p>
                <div class="review-author">- Absalon N.</div>
              </div>

              <div class="review-card">
                <div class="review-stars">★★★★★</div>
                <p class="review-text">
                  "Colin has been great getting me on my feet with music production. He has no problem diving into concepts to make sure I understand before moving on. He's very patient and knowledgeable. He can go over songs that sound impossible to create and break them down into understandable chunks. I highly recommend Colin as a tutor."
                </p>
                <div class="review-author">- Adam S.</div>
              </div>

              <div class="review-card">
                <div class="review-stars">★★★★★</div>
                <p class="review-text">
                  "Colin is great! He's always staying sensitive to my setup/technical limitations and very quickly found the areas I needed the most help in."
                </p>
                <div class="review-author">- Kyle D.</div>
              </div>
            </div>
          </div>
        </div>

        <div class="lessons-contact">
          <a href="mailto:csr@raabfamily.net" class="btn btn--primary">
            Get Started - Contact Me
          </a>
          <p class="contact-note">Lessons available in-person or online via video call</p>
        </div>          
      </div>
    </div>
  </section>
</PageLayout>

<style lang="scss">
  @use '../styles/helpers/responsive' as *;
  @use '../styles/helpers/colors' as *;
  @use '../styles/helpers/fonts' as *;
  @use '../styles/helpers/grid' as *;

  .lessons-page {
    overflow-x: hidden;
    width: 100%;
    
    @include media-down('sm') {
      overflow-x: hidden;
      max-width: 100vw;
    }
    
    .container {
      overflow-x: hidden;
      
      @include media-down('sm') {
        max-width: 100%;
        padding-left: 1rem;
        padding-right: 1rem;
      }
    }
  }

  .page-hero {
    text-align: center;
    margin-bottom: 4rem;
    
    h1 {
      @include font-size('5xl');
      margin-bottom: 1rem;
      
      @include media-down('sm') {
        @include font-size('4xl');
      }
    }
    
    .lead {
      @include font-size('xl');
      @include text-color('text-secondary');
      max-width: 600px;
      margin: 0 auto;
      
      @include media-down('sm') {
        @include font-size('lg');
        max-width: 100%;
        padding: 0 1rem;
      }
    }
  }

  .lessons-description {
    margin-bottom: 3rem;
    max-width: 1000px;
    margin: 0 auto 3rem;
    width: 100%;
    box-sizing: border-box;
    
    @include media-down('sm') {
      margin-bottom: 2rem;
      max-width: 100%;
      padding: 0 1rem;
    }
    
    .lessons-intro {
      @include font-size('lg');
      @include text-color('text-secondary');
      @include line-height('relaxed');
      text-align: center;
      max-width: 800px;
      margin: 0 auto 2rem;
      
      @include media-down('sm') {
        @include font-size('base');
        max-width: 100%;
        margin-bottom: 1.5rem;
      }
    }
  }
  
  .lessons-offerings {
    @include bg-color('bg-secondary');
    padding: 2rem;
    border-radius: 8px;
    border: 1px solid var(--color-border);
    margin-bottom: 2rem;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
    
    @include media-down('sm') {
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      max-width: 100%;
      margin-left: 0;
      margin-right: 0;
    }
    
    h3 {
      @include font-size('xl');
      @include font-weight('semibold');
      margin-bottom: 1rem;
      @include text-color('primary');
      
      @include media-down('sm') {
        @include font-size('lg');
        margin-bottom: 0.75rem;
      }
    }
    
    .offerings-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 0.5rem;
      
      @include media-down('sm') {
        grid-template-columns: 1fr;
        gap: 0.25rem;
        max-width: 100%;
      }
      
      li {
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--color-border-light);
        position: relative;
        padding-left: 1.5rem;
        
        &:before {
          content: '♪';
          position: absolute;
          left: 0;
          @include text-color('primary');
          @include font-weight('bold');
        }
        
        &:last-child {
          border-bottom: none;
        }
      }
    }
  }
  
  .lessons-contact {
    text-align: center;
    
    @include media-down('sm') {
      padding: 0 1rem;
    }
    
    .btn {
      margin-bottom: 1rem;
      padding: 0.75rem 2rem;
      @include font-size('lg');
      
      @include media-down('sm') {
        padding: 0.75rem 1.5rem;
        @include font-size('base');
        width: 100%;
        max-width: 280px;
      }
    }
    
    .contact-note {
      @include font-size('sm');
      @include text-color('text-muted');
      font-style: italic;
    }
  }
  
  .reviews-section {
    margin-bottom: 3rem;
    width: 100%;
    overflow: hidden;
    
    @include media-down('sm') {
      margin-bottom: 2rem;
      margin-left: -1rem;
      margin-right: -1rem;
      width: calc(100% + 2rem);
    }
    
    h3 {
      @include font-size('xl');
      @include font-weight('semibold');
      margin-bottom: 1.5rem;
      text-align: center;
      @include text-color('primary');
      
      @include media-down('sm') {
        @include font-size('lg');
        margin-bottom: 1rem;
      }
    }
    
    .reviews-container {
      overflow: hidden;
      padding: 1rem 0;
      position: relative;
      
      @include media-down('sm') {
        padding: 0.5rem 0;
      }
      
      // Left fade-out effect
      &::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 60px;
        height: 100%;
        background: linear-gradient(to right, var(--color-bg-primary), transparent);
        z-index: 10;
        pointer-events: none;
        
        @include media-down('sm') {
          width: 40px;
        }
      }
      
      // Right fade-out effect
      &::after {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 60px;
        height: 100%;
        background: linear-gradient(to left, var(--color-bg-primary), transparent);
        z-index: 10;
        pointer-events: none;
        
        @include media-down('sm') {
          width: 40px;
        }
      }
      
      .reviews-track {
        display: flex;
        gap: 1.5rem;
        transition: transform 0.3s ease;
        padding: 0 60px; // Add padding to accommodate fade zones
        
        &:hover {
          animation-play-state: paused;
        }
        
        @include media-down('sm') {
          gap: 1rem;
          padding: 0 40px; // Smaller padding on mobile
        }
      }
      
        .review-card {
          flex: 0 0 300px;
          @include bg-color('bg-secondary');
          padding: 1.5rem;
          border-radius: 8px;
          border: 1px solid var(--color-border);
          
          @include media-down('sm') {
            flex: 0 0 calc(100vw - 4rem);
            max-width: 280px;
            min-width: 260px;
            padding: 1rem;
          }        .review-stars {
          @include text-color('accent');
          margin-bottom: 1rem;
          @include font-size('lg');
          
          @include media-down('sm') {
            @include font-size('base');
            margin-bottom: 0.75rem;
          }
        }
        
        .review-text {
          @include text-color('text-secondary');
          @include line-height('relaxed');
          margin-bottom: 1rem;
          font-style: italic;
          
          @include media-down('sm') {
            @include font-size('sm');
            margin-bottom: 0.75rem;
          }
        }
        
        .review-author {
          @include text-color('text-muted');
          @include font-size('sm');
          @include font-weight('medium');
          
          @include media-down('sm') {
            @include font-size('xs');
          }
        }
      }
    }
  }

  .btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    @include font-size('sm');
    @include font-weight('medium');
    text-decoration: none;
    border-radius: 4px;
    transition: all 0.2s ease;
    border: 2px solid transparent;
    
    &--primary {
      @include bg-color('primary');
      color: white;
      
      &:hover {
        background-color: var(--color-secondary);
        color: white;
      }
    }
    
    &--secondary {
      border-color: var(--color-primary);
      @include text-color('primary');
      
      &:hover {
        @include bg-color('primary');
        color: white;
      }
    }
  }
</style>

<script>
  function initializeInfiniteScroll() {
    const reviewsTrack = document.getElementById('reviewsTrack') as HTMLElement;
    const reviewsContainer = document.getElementById('reviewsContainer') as HTMLElement;
    
    if (!reviewsTrack || !reviewsContainer) {
      // If elements aren't ready yet, try again after a short delay
      setTimeout(initializeInfiniteScroll, 50);
      return;
    }
    
    // Check if already initialized to prevent duplicates
    if (reviewsTrack.dataset.initialized === 'true') return;
    reviewsTrack.dataset.initialized = 'true';
    
    // Clone the original cards for seamless infinite scroll
    const originalCards = Array.from(reviewsTrack.children);
    originalCards.forEach(card => {
      const clone = card.cloneNode(true);
      reviewsTrack.appendChild(clone);
    });
    
    let currentTranslateX = 0;
    let cardWidth = 300 + 24; // Default: card width + gap (1.5rem = 24px)
    let fadeZoneWidth = 60; // Width of fade zones
    
    // Adjust card width and fade zone for mobile
    if (window.innerWidth <= 768) {
      cardWidth = Math.min(280, window.innerWidth - 64) + 16; // Mobile: smaller cards + gap
      fadeZoneWidth = 40;
    }
    
    const totalCards = originalCards.length;
    const scrollSpeed = 1; // pixels per frame
    let isHovered = false;
    let animationId: number | null = null;
    
    // Pause animation on hover
    reviewsContainer.addEventListener('mouseenter', () => {
      isHovered = true;
    });
    
    reviewsContainer.addEventListener('mouseleave', () => {
      isHovered = false;
    });
    
    function animate() {
      if (!isHovered) {
        currentTranslateX -= scrollSpeed;
        
        // Calculate the width of one complete set of cards
        const oneSetWidth = cardWidth * totalCards;
        
        // Reset position when we've scrolled past one complete set
        // Account for the fade zone padding
        if (Math.abs(currentTranslateX) >= oneSetWidth) {
          currentTranslateX = 0;
        }
        
        if (reviewsTrack) {
          reviewsTrack.style.transform = `translateX(${currentTranslateX}px)`;
        }
      }
      
      animationId = requestAnimationFrame(animate);
    }
    
    // Start the animation
    animate();
    
    // Clean up on page unload
    function cleanup() {
      if (animationId !== null) {
        cancelAnimationFrame(animationId);
        animationId = null;
      }
      // Reset initialization flag
      if (reviewsTrack) {
        reviewsTrack.dataset.initialized = 'false';
      }
    }
    
    window.addEventListener('beforeunload', cleanup);
    
    // Store cleanup function for view transitions
    (window as any).lessonsScrollCleanup = cleanup;
  }

  // Function to safely initialize after DOM is ready
  function safeInitialize() {
    // Add a longer delay for view transitions to ensure DOM is fully rendered
    setTimeout(() => {
      initializeInfiniteScroll();
    }, 200);
  }

  // Initialize on first load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeInfiniteScroll);
  } else {
    // Document is already loaded
    initializeInfiniteScroll();
  }
  
  // Re-initialize after Astro view transitions
  document.addEventListener('astro:after-swap', () => {
    // Clean up previous instance if it exists
    if ((window as any).lessonsScrollCleanup) {
      (window as any).lessonsScrollCleanup();
    }
    
    // Use longer delay and retry logic for view transitions
    safeInitialize();
  });

  // Also listen for astro:page-load as a fallback
  document.addEventListener('astro:page-load', () => {
    // Clean up previous instance if it exists
    if ((window as any).lessonsScrollCleanup) {
      (window as any).lessonsScrollCleanup();
    }
    
    safeInitialize();
  });
</script>
